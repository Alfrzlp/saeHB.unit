---
output: github_document
---

```{r, include = FALSE}
knitr::opts_chunk$set(
  collapse = TRUE,
  comment = "#>",
  fig.path = "man/figures/README-"
)
```

# saeHB.unit

<!-- badges: start -->

[![CRAN status](https://www.r-pkg.org/badges/version/saeHB.unit)](https://CRAN.R-project.org/package=saeHB.unit) [![check-standard](https://github.com/Alfrzlp/saeHB.unit/actions/workflows/check-standard.yaml/badge.svg)](https://github.com/Alfrzlp/saeHB.unit/actions/workflows/check-standard.yaml)

<!-- badges: end -->

# Author

Azka Ubaidillah, Ridson Al Farizal P

# Maintainer

Ridson Al Farizal P \<alfrzlp\@gmail.com\>

# Description

We designed this package to provide several functions for unit level of small area estimation (Battese, Harter and Fuller model) using hierarchical Bayesian (HB) method. This package also provides a dataset produced by a data generation. The `rjags` package is employed to obtain parameter estimates

# Installation

You can install the development version of saeHB.unit from [GitHub](https://github.com/) with:

```{r, eval=FALSE}
install.packages("devtools")
devtools::install_github("Alfrzlp/saeHB.unit")
```

Or you can install cran version with

```{r, eval=FALSE}
install.packages(saeHB.unit)
```

## Example 1

This is a basic example which shows you how to solve a common problem:

```{r warning=FALSE, message=FALSE}
library(dplyr)
library(saeHB.unit)
library(ggplot2)
library(tidyr)

windowsFonts(
  poppins = windowsFont('poppins'),
  tnr = windowsFont('Times New Roman')
)
```

### Data
```{r}
glimpse(cornsoybean)
glimpse(cornsoybeanmeans)
```

```{r}
Xarea <- cornsoybeanmeans %>%
   dplyr::select(
      County = CountyIndex,
      CornPix = MeanCornPixPerSeg,
      SoyBeansPix = MeanSoyBeansPixPerSeg
   )
head(Xarea)
```
### Model
```{r echo=TRUE, message=FALSE}
corn_model <- hb_BHF(
   CornHec ~ SoyBeansPix + CornPix,
   data_unit = cornsoybean,
   data_area = Xarea,
   domain = "County",
   iter.update = 20
)
```

## Example 2

### Data

```{r}
head(dummy_unit)
```

```{r}
head(dummy_area)
```
### Model
```{r}
hb_model <- hb_BHF(
  formula = y_di ~ x1 + x2,
  data_unit = dummy_unit,
  data_area = dummy_area,
  domain = "domain",
  iter.update = 30,
  plot = FALSE
)
```

## Autocorelation, Trace and Density plot
```{r}
saeHB.unit::autoplot(hb_model)
```
## Coefficients
```{r}
summary(hb_model)
```

```{r, dpi=500, fig.height=3, fig.width=7}
data.frame(
  id = 1:30,
  hb = hb_model$Est$MEAN,
  parameter = dummy_area$parameter
) %>%
  pivot_longer(-1, names_to = "metode", values_to = "rse") %>%
  ggplot(aes(x = id, y = rse, col = metode)) +
  geom_line() +
  scale_color_discrete(
    labels = c('HB with NA', 'Parameter')
  ) +
  labs(col = NULL, y = 'Estimate', x = 'County', title = 'Comparison of estimates') +
  theme(
    text = element_text(family = 'poppins'),
    axis.ticks.x = element_blank(),
    plot.title = element_text(face = 2, vjust = 0),
    plot.subtitle = element_text(colour = 'gray30', vjust = 0)
  )
```

# References

-   Battese, G. E., Harter, R. M., & Fuller, W. A. (1988). An error-components model for prediction of county crop areas using survey and satellite data. Journal of the American Statistical Association, 83(401), 28-36.

-   Rao, J. N., & Molina, I. (2015). Small area estimation. John Wiley & Sons.
